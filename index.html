<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Planes de Estudio</title>

    <script src="lib/ejs.min.js"></script>
</head>
<body>
    <div class="interseccion"></div>
    <div id="diferencia__lic-tec"></div>
    <div id="diferencia__tec-lic"></div>

    <script>
        const getPlan = (urlPlat, clb) => {
            fetch(urlPlat)
                .then(res => res.json())
                .then(res => clb(res))
        }


        const interseccion = (tec, lic) => {
            let year = 0;
            let array = [];

            for (let maTec = 0; maTec < tec[year].length; maTec++) {
                const materiaTec = tec[year][maTec];

                for (let maLic = 0; maLic < lic[year].length; maLic++) {
                    const materiaLic = lic[year][maLic];

                    if(materiaTec === materiaLic){

                        if(!array[year]) array.push([])

                        array[year].push(materiaTec);
                        break;
                    }
                }

                if(materiaTec == tec[year][tec[year].length - 1]) {
                    year++;
                    maTec = 0;

                    if(year >= tec.length) break;
                }
            }

            return array;
        };
        const diferencia = (yearsA, yearsB) => {

            return yearsA.map( yearA => {
                const matB = yearsB[yearsA.indexOf(yearA)];
                if(matB)
                    return yearA.filter(matA => !matB.includes(matA));
            })
        };

        getPlan('plan-de-estudios/index.json', ({tecnicatura, licenciatura}) => {
            const materiasTec = tecnicatura.map(year => year.map(materia => materia.nombre));
            const materiasLic = licenciatura.map(year => year.map(materia => materia.nombre));

            const dataInterseccion = {interseccion: interseccion(materiasTec, materiasLic)};
            loadData('interseccion', dataInterseccion, '.interseccion');

            let dataDiferencia = {dif: diferencia(materiasLic, materiasTec), conjs: ['Lic', 'Tec'], img: ['conjA-conjB.png']};
            loadData('diferencia', dataDiferencia, '#diferencia__lic-tec');

            dataDiferencia = {dif: diferencia(materiasTec, materiasLic), conjs: ['Tec', 'Lic'], img: ['conjB-conjA.png']};
            loadData('diferencia', dataDiferencia, '#diferencia__tec-lic');
        });


        const loadData = (section, data, tag) => {
            fetch('view/' + section)
                .then(res => res.text())
                .then(template => {
                    const html = ejs.render(template, data);
                    document.querySelector(tag).innerHTML += html;
                });
        }
    </script>

</body>
</html>
